#!/bin/bash

# Vérifier quel service doit être lancé
if [ "$1" == "clamav" ]; then

    # Démarrer le service clamav-daemon
    echo "Démarrage du service clamav-daemon..."
    service clamav-daemon start
fi

if [ "$1" == "analyze_url" ]; then

    #Construire le conteneur analyze_url
    docker build -f analyze_url -t analyze_url .

    #Attendre que la construction soit terminée
    wait

    echo "L'image analyze_url a été construite."

    #Démarrer le conteneur analyze_url
    docker run -d --name analyze_url analyze_url

    wait 

    echo "Le conteneur analyze_url a été démarré."
    #copier le script analyze_url.py dans le conteneur analyze_url
    docker cp /script/script_LightningMalware/src_analyze/API_KEY.py analyze_url:/tmp/API_KEY.py
    docker cp /script/script_LightningMalware/src_analyze/analyze_url.py analyze_url:/tmp/analyze_url.py
    docker exec -it analyze_url /bin/bash -c "source /venv/bin/activate"
    docker exec analyze_url python3 /tmp/analyze_url.py  https://www.amazon.fr
    #récupérer le fichier de résultat
    docker cp analyze_url:/tmp/result_url.txt /script/script_LightningMalware/src_analyze/result.txt

    #supprimer le conteneur analyze_url
docker rm -f analyze_url

fi

# Garder le conteneur en vie
tail -f /dev/null
